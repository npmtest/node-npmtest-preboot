<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for node-npmtest-preboot/node_modules/preboot/__build/src/browser/preboot_browser.js</title>
    <meta charset="utf-8">
    <style>
        body, html {
            margin:0; padding: 0;
        }
        body {
            font-family: Arial, Helvetica;
            font-size: 10pt;
        }
        div.header, div.footer {
            background: #eee;
            padding: 1em;
        }
        div.header {
            height: 160px;
            padding: 0 1em 0 1em;
            z-index: 100;
            position: fixed;
            top: 0;
            border-bottom: 1px solid #666;
            width: 100%;
        }
        div.footer {
            border-top: 1px solid #666;
        }
        div.body {
            margin-top: 170px;
        }
        div.meta {
            font-size: 90%;
            text-align: center;
        }
        h1, h2, h3 {
            font-weight: normal;
        }
        h1 {
            font-size: 12pt;
        }
        h2 {
            font-size: 10pt;
        }
        pre {
            font-family: Menlo, Monaco, Consolas, Courier New, monospace;
            margin: 0;
            padding: 0;
            font-size: 14px;
            tab-size: 2;
        }

        div.path { font-size: 110%; }
        div.path a:link, div.path a:visited { color: #000; }
        table.coverage { border-collapse: collapse; margin:0; padding: 0 }

        table.coverage td {
            margin: 0;
            padding: 0;
            color: #111;
            vertical-align: top;
        }
        table.coverage td.line-count {
            width: 50px;
            text-align: right;
            padding-right: 5px;
        }
        table.coverage td.line-coverage {
            color: #777 !important;
            text-align: right;
            border-left: 1px solid #666;
            border-right: 1px solid #666;
        }

        table.coverage td.text {
        }

        table.coverage td span.cline-any {
            display: inline-block;
            padding: 0 5px;
            width: 40px;
        }
        table.coverage td span.cline-neutral {
            background: #eee;
        }
        table.coverage td span.cline-yes {
            background: #b5d592;
            color: #999;
        }
        table.coverage td span.cline-no {
            background: #fc8c84;
        }

        .cstat-yes { color: #111; }
        .cstat-no { background: #fc8c84; color: #111; }
        .fstat-no { background: #ffc520; color: #111 !important; }
        .cbranch-no { background:  yellow !important; color: #111; }

        .cstat-skip { background: #ddd; color: #111; }
        .fstat-skip { background: #ddd; color: #111 !important; }
        .cbranch-skip { background: #ddd !important; color: #111; }

        .missing-if-branch {
            display: inline-block;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: black;
            color: yellow;
        }

        .skip-if-branch {
            display: none;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: #ccc;
            color: white;
        }

        .missing-if-branch .typ, .skip-if-branch .typ {
            color: inherit !important;
        }

        .entity, .metric { font-weight: bold; }
        .metric { display: inline-block; border: 1px solid #333; padding: 0.3em; background: white; }
        .metric small { font-size: 80%; font-weight: normal; color: #666; }

        div.coverage-summary table { border-collapse: collapse; margin: 3em; font-size: 110%; }
        div.coverage-summary td, div.coverage-summary table  th { margin: 0; padding: 0.25em 1em; border-top: 1px solid #666; border-bottom: 1px solid #666; }
        div.coverage-summary th { text-align: left; border: 1px solid #666; background: #eee; font-weight: normal; }
        div.coverage-summary th.file { border-right: none !important; }
        div.coverage-summary th.pic { border-left: none !important; text-align: right; }
        div.coverage-summary th.pct { border-right: none !important; }
        div.coverage-summary th.abs { border-left: none !important; text-align: right; }
        div.coverage-summary td.pct { text-align: right; border-left: 1px solid #666; }
        div.coverage-summary td.abs { text-align: right; font-size: 90%; color: #444; border-right: 1px solid #666; }
        div.coverage-summary td.file { text-align: right; border-left: 1px solid #666; white-space: nowrap;  }
        div.coverage-summary td.pic { min-width: 120px !important;  }
        div.coverage-summary a:link { color: #000; }
        div.coverage-summary a:visited { color: #333; }
        div.coverage-summary tfoot td { border-top: 1px solid #666; }

        div.coverage-summary .yui3-datatable-sort-indicator, div.coverage-summary .dummy-sort-indicator {
            height: 10px;
            width: 7px;
            display: inline-block;
            margin-left: 0.5em;
        }
        div.coverage-summary .yui3-datatable-sort-indicator {
            background: no-repeat scroll 0 0 transparent;
        }
        div.coverage-summary .yui3-datatable-sorted .yui3-datatable-sort-indicator {
            background-position: 0 -20px;
        }
        div.coverage-summary .yui3-datatable-sorted-desc .yui3-datatable-sort-indicator {
            background-position: 0 -10px;
        }

        .high { background: #b5d592 !important; }
        .medium { background: #ffe87c !important; }
        .low { background: #fc8c84 !important; }

        span.cover-fill, span.cover-empty {
            display:inline-block;
            border:1px solid #444;
            background: white;
            height: 12px;
        }
        span.cover-fill {
            background: #ccc;
            border-right: 1px solid #444;
        }
        span.cover-empty {
            background: white;
            border-left: none;
        }
        span.cover-full {
            border-right: none !important;
        }
        pre.prettyprint {
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
        }
        .com { color: #999 !important; }
        .ignore-none { color: #999; font-weight: normal; }

    </style>
</head>
<body>
<div class="header low">
    <h1 style="font-weight: bold;">
        <a href="https://github.com/npmtest/node-npmtest-preboot">npmtest-preboot (v0.0.1)</a>
    </h1>
    <h1>Code coverage report for <span class="entity">node-npmtest-preboot/node_modules/preboot/__build/src/browser/preboot_browser.js</span></h1>
    <h2>
        
        Statements: <span class="metric">10.94% <small>(14 / 128)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Branches: <span class="metric">0% <small>(0 / 107)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Functions: <span class="metric">7.69% <small>(1 / 13)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Lines: <span class="metric">11.11% <small>(14 / 126)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../../../../../index.html">All files</a> &#187; <a href="index.html">node-npmtest-preboot/node_modules/preboot/__build/src/browser/</a> &#187; preboot_browser.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283</td><td class="line-coverage"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">/**
 * This is the entry point for the client side preboot library. At a high level, this library
 * is used to facilitate the switch from the server view to the client view. Specifically that
 * means:
 *
 *    1. Replay stored server view events on client view
 *    2. Switch buffer from server view to client view
 *    3. Reset focus on client view
 */
"use strict";
// the idea here is that preboot is a global value on the window that is used by the client
var preboot = prebootClient();
// wrapper function used to contain all the preboot client functionality
function prebootClient() {
    // used to cache map from server node key to associated client node
    var clientNodeCache = {};
    /**
     * External code call this to kick off the switch from server to client
     */
<span class="fstat-no" title="function not covered" >    function complete(opts) {</span>
<span class="cstat-no" title="statement not covered" >        opts = opts || {};</span>
<span class="cstat-no" title="statement not covered" >        var theWindow = (opts.window || window);</span>
<span class="cstat-no" title="statement not covered" >        var prebootData = theWindow.prebootData || {};</span>
<span class="cstat-no" title="statement not covered" >        var apps = prebootData.apps || [];</span>
        // loop through each of the preboot apps
<span class="cstat-no" title="statement not covered" >        apps.forEach(<span class="fstat-no" title="function not covered" >function (appData) {</span> <span class="cstat-no" title="statement not covered" >return completeApp(opts, appData); </span>});</span>
        // once all events have been replayed and buffers switched, then we cleanup preboot
<span class="cstat-no" title="statement not covered" >        if (!opts.noCleanup) {</span>
<span class="cstat-no" title="statement not covered" >            cleanup(theWindow, prebootData);</span>
        }
    }
    /**
     * Complete a particular app
     * @param opts
     * @param appData
     */
<span class="fstat-no" title="function not covered" >    function completeApp(opts, appData) {</span>
<span class="cstat-no" title="statement not covered" >        opts = opts || {};</span>
<span class="cstat-no" title="statement not covered" >        appData = (appData || {});</span>
<span class="cstat-no" title="statement not covered" >        var theWindow = (opts.window || window);</span>
<span class="cstat-no" title="statement not covered" >        var root = (appData.root || {});</span>
<span class="cstat-no" title="statement not covered" >        var events = appData.events || [];</span>
        // if a specific app root set and it doesn't equal the server selector, then don't do anything
<span class="cstat-no" title="statement not covered" >        if (opts.appRoot &amp;&amp; opts.appRoot !== root.serverSelector) {</span>
<span class="cstat-no" title="statement not covered" >            return;</span>
        }
        // some client side frameworks (like Angular 1 w UI Router) will replace
        // elements, so we need to re-get client root just to be safe
<span class="cstat-no" title="statement not covered" >        root.clientNode = theWindow.document.querySelector(root.clientSelector);</span>
        // replay all the events from the server view onto the client view
<span class="cstat-no" title="statement not covered" >        events.forEach(<span class="fstat-no" title="function not covered" >function (event) {</span> <span class="cstat-no" title="statement not covered" >return replayEvent(appData, event); </span>});</span>
        // if we are buffering, switch the buffers
<span class="cstat-no" title="statement not covered" >        switchBuffer(theWindow, appData);</span>
    }
    /**
     * Replay a particular event. The trick here is finding the appropriate client
     * node where the event is to be dispatched that matches up with the server node
     * where the event came from originally.
     */
<span class="fstat-no" title="function not covered" >    function replayEvent(appData, prebootEvent) {</span>
<span class="cstat-no" title="statement not covered" >        appData = (appData || {});</span>
<span class="cstat-no" title="statement not covered" >        prebootEvent = (prebootEvent || {});</span>
<span class="cstat-no" title="statement not covered" >        var event = prebootEvent.event;</span>
<span class="cstat-no" title="statement not covered" >        var serverNode = prebootEvent.node || {};</span>
<span class="cstat-no" title="statement not covered" >        var nodeKey = prebootEvent.nodeKey;</span>
<span class="cstat-no" title="statement not covered" >        var clientNode = findClientNode({</span>
            root: appData.root,
            node: serverNode,
            nodeKey: nodeKey
        });
        // if client node can't be found, log a warning
<span class="cstat-no" title="statement not covered" >        if (!clientNode) {</span>
<span class="cstat-no" title="statement not covered" >            console.warn('Trying to dispatch event ' + event.type +</span>
                ' to node ' + nodeKey + ' but could not find client node. ' +
                'Server node is: ');
<span class="cstat-no" title="statement not covered" >            console.log(serverNode);</span>
<span class="cstat-no" title="statement not covered" >            return;</span>
        }
        // now dispatch events and whatnot to the client node
<span class="cstat-no" title="statement not covered" >        clientNode.checked = serverNode.checked ? true : undefined;</span>
<span class="cstat-no" title="statement not covered" >        clientNode.selected = serverNode.selected ? true : undefined;</span>
<span class="cstat-no" title="statement not covered" >        clientNode.value = serverNode.value;</span>
<span class="cstat-no" title="statement not covered" >        clientNode.dispatchEvent(event);</span>
    }
    /**
     * Hide the server buffer and show the client buffer
     */
<span class="fstat-no" title="function not covered" >    function switchBuffer(window, appData) {</span>
<span class="cstat-no" title="statement not covered" >        appData = (appData || {});</span>
<span class="cstat-no" title="statement not covered" >        var root = (appData.root || {});</span>
<span class="cstat-no" title="statement not covered" >        var serverView = root.serverNode;</span>
<span class="cstat-no" title="statement not covered" >        var clientView = root.clientNode;</span>
        // if no client view or the server view is the body or client
        // and server view are the same, then don't do anything and return
<span class="cstat-no" title="statement not covered" >        if (!clientView || !serverView || serverView === clientView || serverView.nodeName === 'BODY') {</span>
<span class="cstat-no" title="statement not covered" >            return;</span>
        }
        // do a try-catch for case where serverView is an object but NOT of type Element
<span class="cstat-no" title="statement not covered" >        try {</span>
            // get the server view display mode
<span class="cstat-no" title="statement not covered" >            var display = window</span>
                .getComputedStyle(serverView)
                .getPropertyValue('display') || 'block';
            // first remove the server view
<span class="cstat-no" title="statement not covered" >            serverView.remove ?</span>
                serverView.remove() :
                serverView.style.display = 'none';
            // now add the client view
<span class="cstat-no" title="statement not covered" >            clientView.style.display = display;</span>
        }
        catch (ex) {
<span class="cstat-no" title="statement not covered" >            console.error(ex);</span>
        }
    }
    /**
     * This function does three things to cleanup preboot:
     *    1. Set focus (and selection if a text box/text area) within a form element
     *    2. Remove existing event listeners
     *    3. Delete data from memory
     */
<span class="fstat-no" title="function not covered" >    function cleanup(window, prebootData) {</span>
<span class="cstat-no" title="statement not covered" >        prebootData = prebootData || {};</span>
<span class="cstat-no" title="statement not covered" >        var listeners = prebootData.listeners || [];</span>
        // set focus on the active node AFTER a small delay to ensure buffer switched
<span class="cstat-no" title="statement not covered" >        setTimeout(<span class="fstat-no" title="function not covered" >function () {</span></span>
<span class="cstat-no" title="statement not covered" >            setFocus(prebootData.activeNode);</span>
        }, 1);
        // remove all event listeners
<span class="cstat-no" title="statement not covered" >        for (var _i = 0, listeners_1 = listeners; _i &lt; listeners_1.length; _i++) {</span>
<span class="cstat-no" title="statement not covered" >            var listener = listeners_1[_i];</span>
<span class="cstat-no" title="statement not covered" >            listener.node.removeEventListener(listener.eventName, listener.handler);</span>
        }
        // remove the freeze overlay if it exists
<span class="cstat-no" title="statement not covered" >        removeOverlay(window);</span>
        // finally clear out the data stored for each app
<span class="cstat-no" title="statement not covered" >        prebootData.apps = [];</span>
<span class="cstat-no" title="statement not covered" >        clientNodeCache = {};</span>
    }
    /**
     * Remove the overlay if it exists
     */
<span class="fstat-no" title="function not covered" >    function removeOverlay(window) {</span>
<span class="cstat-no" title="statement not covered" >        var prebootOverlay = window.document.body.querySelector('#prebootOverlay');</span>
<span class="cstat-no" title="statement not covered" >        if (prebootOverlay) {</span>
<span class="cstat-no" title="statement not covered" >            prebootOverlay.style.display = 'none';</span>
        }
    }
    /**
     * Set focus on a given active node element
     */
<span class="fstat-no" title="function not covered" >    function setFocus(activeNode) {</span>
        // only do something if there is an active node
<span class="cstat-no" title="statement not covered" >        if (!activeNode || !activeNode.node || !activeNode.nodeKey) {</span>
<span class="cstat-no" title="statement not covered" >            return;</span>
        }
        // find the client node in the new client view
<span class="cstat-no" title="statement not covered" >        var clientNode = findClientNode(activeNode);</span>
<span class="cstat-no" title="statement not covered" >        if (clientNode) {</span>
            // set focus on the client node
<span class="cstat-no" title="statement not covered" >            clientNode.focus();</span>
            // set selection if a modern browser (i.e. IE9+, etc.)
<span class="cstat-no" title="statement not covered" >            var selection = activeNode.selection;</span>
<span class="cstat-no" title="statement not covered" >            if (clientNode.setSelectionRange &amp;&amp; selection) {</span>
<span class="cstat-no" title="statement not covered" >                clientNode.setSelectionRange(selection.start, selection.end, selection.direction);</span>
            }
        }
    }
    /**
     * Given a node from the server rendered view, find the equivalent
     * node in the client rendered view. We do this by the following approach:
     *      1. take the name of the server node tag (ex. div or h1 or input)
     *      2. add either id (ex. div#myid) or class names (ex. div.class1.class2)
     *      3. use that value as a selector to get all the matching client nodes
     *      4. loop through all client nodes found and for each generate a key value
     *      5. compare the client key to the server key; once there is a match, we have our client node
     *
     * NOTE: this only works when the client view is almost exactly the same as the server
     * view. we will need an improvement here in the future to account for situations
     * where the client view is different in structure from the server view
     */
<span class="fstat-no" title="function not covered" >    function findClientNode(serverNodeContext) {</span>
<span class="cstat-no" title="statement not covered" >        serverNodeContext = (serverNodeContext || {});</span>
<span class="cstat-no" title="statement not covered" >        var serverNode = serverNodeContext.node;</span>
<span class="cstat-no" title="statement not covered" >        var root = serverNodeContext.root;</span>
        // if no server or client root, don't do anything
<span class="cstat-no" title="statement not covered" >        if (!root || !root.serverNode || !root.clientNode) {</span>
<span class="cstat-no" title="statement not covered" >            return null;</span>
        }
        // we use the string of the node to compare to the client node &amp; as key in cache
<span class="cstat-no" title="statement not covered" >        var serverNodeKey = serverNodeContext.nodeKey || getNodeKey(serverNodeContext);</span>
        // if client node already in cache, return it
<span class="cstat-no" title="statement not covered" >        if (clientNodeCache[serverNodeKey]) {</span>
<span class="cstat-no" title="statement not covered" >            return clientNodeCache[serverNodeKey];</span>
        }
        // get the selector for client nodes
<span class="cstat-no" title="statement not covered" >        var className = (serverNode.className || '').replace('ng-binding', '').trim();</span>
<span class="cstat-no" title="statement not covered" >        var selector = serverNode.tagName;</span>
<span class="cstat-no" title="statement not covered" >        if (serverNode.id) {</span>
<span class="cstat-no" title="statement not covered" >            selector += '#' + serverNode.id;</span>
        }
        else <span class="cstat-no" title="statement not covered" >if (className) {</span>
<span class="cstat-no" title="statement not covered" >            selector += '.' + className.replace(/ /g, '.');</span>
        }
        // select all possible client nodes and look through them to try and find a match
<span class="cstat-no" title="statement not covered" >        var rootClientNode = root.clientNode;</span>
<span class="cstat-no" title="statement not covered" >        var clientNodes = rootClientNode.querySelectorAll(selector) || [];</span>
        // if nothing found, then just try the tag name as a final option
<span class="cstat-no" title="statement not covered" >        if (!clientNodes.length) {</span>
<span class="cstat-no" title="statement not covered" >            clientNodes = rootClientNode.querySelectorAll(serverNode.tagName) || [];</span>
        }
<span class="cstat-no" title="statement not covered" >        for (var _i = 0, clientNodes_1 = clientNodes; _i &lt; clientNodes_1.length; _i++) {</span>
<span class="cstat-no" title="statement not covered" >            var clientNode = clientNodes_1[_i];</span>
            // get the key for the client node
<span class="cstat-no" title="statement not covered" >            var clientNodeKey = getNodeKey({ root: root, node: clientNode });</span>
            // if the client node key is exact match for the server node key, then we found the client node
<span class="cstat-no" title="statement not covered" >            if (clientNodeKey === serverNodeKey) {</span>
<span class="cstat-no" title="statement not covered" >                clientNodeCache[serverNodeKey] = clientNode;</span>
<span class="cstat-no" title="statement not covered" >                return clientNode;</span>
            }
        }
        // if we get here and there is one clientNode, use it as a fallback
<span class="cstat-no" title="statement not covered" >        if (clientNodes.length === 1) {</span>
<span class="cstat-no" title="statement not covered" >            clientNodeCache[serverNodeKey] = clientNodes[0];</span>
<span class="cstat-no" title="statement not covered" >            return clientNodes[0];</span>
        }
        // if we get here it means we couldn't find the client node so give the user a warning
<span class="cstat-no" title="statement not covered" >        console.warn('No matching client node found for ' + serverNodeKey +</span>
            '. You can fix this by assigning this element a unique id attribute.');
<span class="cstat-no" title="statement not covered" >        return null;</span>
    }
    /**
     * Attempt to generate key from node position in the DOM
     *
     * NOTE: this function is duplicated in preboot_inline.ts and must be
     * kept in sync. It is duplicated for right now since we are trying
     * to keep all inline code separated and distinct (i.e. without imports)
     */
<span class="fstat-no" title="function not covered" >    function getNodeKey(nodeContext) {</span>
<span class="cstat-no" title="statement not covered" >        var ancestors = [];</span>
<span class="cstat-no" title="statement not covered" >        var root = nodeContext.root;</span>
<span class="cstat-no" title="statement not covered" >        var node = nodeContext.node;</span>
<span class="cstat-no" title="statement not covered" >        var temp = node;</span>
        // walk up the tree from the target node up to the root
<span class="cstat-no" title="statement not covered" >        while (temp &amp;&amp; temp !== root.serverNode &amp;&amp; temp !== root.clientNode) {</span>
<span class="cstat-no" title="statement not covered" >            ancestors.push(temp);</span>
<span class="cstat-no" title="statement not covered" >            temp = temp.parentNode;</span>
        }
        // note: if temp doesn't exist here it means root node wasn't found
<span class="cstat-no" title="statement not covered" >        if (temp) {</span>
<span class="cstat-no" title="statement not covered" >            ancestors.push(temp);</span>
        }
        // now go backwards starting from the root, appending the appName to unique identify the node later..
<span class="cstat-no" title="statement not covered" >        var name = node.nodeName || 'unknown';</span>
<span class="cstat-no" title="statement not covered" >        var key = name + '_' + root.serverSelector;</span>
<span class="cstat-no" title="statement not covered" >        var len = ancestors.length;</span>
<span class="cstat-no" title="statement not covered" >        for (var i = (len - 1); i &gt;= 0; i--) {</span>
<span class="cstat-no" title="statement not covered" >            temp = ancestors[i];</span>
<span class="cstat-no" title="statement not covered" >            if (temp.childNodes &amp;&amp; i &gt; 0) {</span>
<span class="cstat-no" title="statement not covered" >                for (var j = 0; j &lt; temp.childNodes.length; j++) {</span>
<span class="cstat-no" title="statement not covered" >                    if (temp.childNodes[j] === ancestors[i - 1]) {</span>
<span class="cstat-no" title="statement not covered" >                        key += '_s' + (j + 1);</span>
<span class="cstat-no" title="statement not covered" >                        break;</span>
                    }
                }
            }
        }
<span class="cstat-no" title="statement not covered" >        return key;</span>
    }
    return {
        complete: complete,
        completeApp: completeApp,
        replayEvent: replayEvent,
        switchBuffer: switchBuffer,
        removeOverlay: removeOverlay,
        cleanup: cleanup,
        setFocus: setFocus,
        findClientNode: findClientNode,
        getNodeKey: getNodeKey
    };
}
exports.prebootClient = prebootClient;
&nbsp;
&nbsp;</pre></td></tr>
</table></pre>
</div>
<div class="footer">
    <div class="meta">Generated by <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a> at Fri Apr 21 2017 11:01:02 GMT+0000 (UTC)</div>
</div>
</body>
</html>
